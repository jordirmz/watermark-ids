<!--
MIT License

Copyright (c) 2025 jordirmz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<!--
Code available in: https://github.com/jordirmz/watermark-ids.
Code adapted from Martin Aberastegue original code: https://github.com/Xyborg/datosargentinos.com.
New features: Run only in one file (index.html), blur feature is now a brush.
-->
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparte documentos con marca de agua</title>
    <meta name="description" content="Comparte documentos agregando una marca de agua y ofuscando tus datos sensibles.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Comparte documentos con marca de agua">
    <meta property="og:description"
        content="Comparte documentos agregando una marca de agua y ofuscando tus datos sensibles.">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'">
    <style>
        .transition-colors,
        .transition-transform {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1)
        }

        .comparison-slider img,
        .comparison-slider-wrapper>img {
            left: 0;
            height: 100%;
            object-fit: cover;
            pointer-events: none
        }

        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border: 0 solid #e5e7eb;
            margin: 0;
            padding: 0
        }

        body {
            font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.5;
            color: #1f2937;
            background: linear-gradient(135deg, #f0f7ff 0%, #fff7ed 100%);
            min-height: 100vh
        }

        :root {
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-brightness: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-contrast: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-grayscale: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-hue-rotate: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-invert: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-saturate: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-sepia: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-drop-shadow: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-blur: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-brightness: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-contrast: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-grayscale: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-hue-rotate: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-invert: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-opacity: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-saturate: var(--tw-empty,
                    /*!*/
                    /*!*/
                );
            --tw-backdrop-sepia: var(--tw-empty,
                    /*!*/
                    /*!*/
                )
        }

        .max-h-40 {
            max-height: 10rem
        }

        .opacity-75 {
            opacity: .75
        }

        .opacity-90 {
            opacity: .9
        }

        .select-none {
            user-select: none;
            -webkit-user-select: none
        }

        .pointer-events-none {
            pointer-events: none
        }

        .pointer-events-auto,
        .slider-handle {
            pointer-events: auto
        }

        .whitespace-nowrap {
            white-space: nowrap
        }

        .break-words {
            word-wrap: break-word
        }

        .break-all {
            word-break: break-all
        }

        .hidden {
            display: none
        }

        .block {
            display: block
        }

        .inline-block {
            display: inline-block
        }

        .flex {
            display: flex
        }

        .flex-col {
            flex-direction: column
        }

        .relative {
            position: relative
        }

        .absolute {
            position: absolute
        }

        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0
        }

        .top-1\/2 {
            top: 50%
        }

        .right-4 {
            right: 1rem
        }

        .w-full {
            width: 100%
        }

        .h-12,
        .w-12 {
            width: 3rem
        }

        .w-5 {
            width: 1.25rem
        }

        .h-20 {
            height: 5rem
        }

        .h-5 {
            height: 1.25rem
        }

        .h-2 {
            height: .5rem
        }

        .max-w-4xl {
            max-width: 56rem
        }

        .min-h-screen {
            min-height: 100vh
        }

        .transform {
            transform: translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .-translate-y-1\/2 {
            --tw-translate-y: -50%;
            transform: var(--tw-transform)
        }

        .hover\:scale-105:hover {
            --tw-scale-x: 1.05;
            --tw-scale-y: 1.05;
            transform: var(--tw-transform)
        }

        .p-8 {
            padding: 2rem
        }

        .p-4 {
            padding: 1rem
        }

        .p-3 {
            padding: .75rem
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem
        }

        .pt-8 {
            padding-top: 2rem
        }

        .pb-20 {
            padding-bottom: 5rem
        }

        .pr-16 {
            padding-right: 4rem
        }

        .mt-auto {
            margin-top: auto
        }

        .mt-12 {
            margin-top: 3rem
        }

        .mt-8 {
            margin-top: 2rem
        }

        .mt-6,
        .space-y-6>*+* {
            margin-top: 1.5rem
        }

        .mt-2 {
            margin-top: .5rem
        }

        .mb-16 {
            margin-bottom: 4rem
        }

        .mb-8 {
            margin-bottom: 2rem
        }

        .mb-6 {
            margin-bottom: 1.5rem
        }

        .mb-4 {
            margin-bottom: 1rem
        }

        .mb-2 {
            margin-bottom: .5rem
        }

        .mr-2 {
            margin-right: .5rem
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto
        }

        .space-y-4>*+* {
            margin-top: 1rem
        }

        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem
        }

        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-base {
            font-size: 1rem;
            line-height: 1.5rem
        }

        .text-sm {
            font-size: .875rem;
            line-height: 1.25rem
        }

        .font-bold {
            font-weight: 700
        }

        .font-semibold {
            font-weight: 600
        }

        .font-medium {
            font-weight: 500
        }

        .text-center {
            text-align: center
        }

        .text-white {
            color: #fff
        }

        .hover\:text-gray-800:hover,
        .text-gray-800 {
            color: #1f2937
        }

        .text-gray-600 {
            color: #4b5563
        }

        .text-gray-500 {
            color: #6b7280
        }

        .text-gray-400 {
            color: #9ca3af
        }

        .text-blue-600 {
            color: #2563eb
        }

        .text-purple-700 {
            color: #6d28d9
        }

        .bg-white {
            background-color: #fff
        }

        .bg-blue-50 {
            background-color: #eff6ff
        }

        .bg-purple-50 {
            background-color: #f5f3ff
        }

        .bg-purple-200 {
            background-color: #ddd6fe
        }

        .bg-gradient-to-br {
            background-image: linear-gradient(to bottom right, var(--tw-gradient-stops))
        }

        .from-gray-50 {
            --tw-gradient-from: #f9fafb;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, #f9fafb)
        }

        .to-gray-100 {
            --tw-gradient-to: #f3f4f6
        }

        .border {
            border-width: 1px
        }

        .border-gray-300 {
            border-color: #d1d5db
        }

        .rounded-2xl {
            border-radius: 1rem
        }

        .rounded-lg {
            border-radius: .5rem
        }

        .shadow-xl {
            --tw-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .canvas-container,
        .comparison-slider-wrapper {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);
            overflow: hidden
        }

        .cursor-pointer {
            cursor: pointer
        }

        .cursor-crosshair {
            cursor: crosshair
        }

        .appearance-none {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none
        }

        .transition-colors {
            transition-property: background-color, border-color, color, fill, stroke;
            transition-duration: .2s
        }

        .transition-transform {
            transition-property: transform;
            transition-duration: .3s
        }

        .duration-200 {
            transition-duration: .2s
        }

        .duration-300 {
            transition-duration: .3s
        }

        .focus\:ring-2:focus {
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)
        }

        .focus\:ring-blue-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgba(59, 130, 246, var(--tw-ring-opacity))
        }

        .focus\:border-transparent:focus {
            border-color: transparent
        }

        .items-center {
            align-items: center
        }

        .transition-all {
            transition: .3s ease-in-out
        }

        .custom-file-upload {
            border: 2px dashed #93c5fd;
            border-radius: .5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: .3s;
            background-color: #f0f7ff
        }

        .custom-file-upload:hover {
            border-color: #3b82f6;
            background-color: #eff6ff
        }

        .step-transition {
            transition: opacity .5s ease-in-out, transform .5s ease-in-out
        }

        .step-enter {
            opacity: 0;
            transform: translateY(20px)
        }

        .step-enter-active {
            opacity: 1;
            transform: translateY(0)
        }

        .canvas-container {
            border-radius: .5rem
        }

        .gradient-button {
            background: linear-gradient(135deg, #2563eb 0, #3b82f6 100%);
            transition: transform .2s, box-shadow .2s;
            border: none;
            cursor: pointer
        }

        .gradient-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3)
        }

        .blur-button {
            background: linear-gradient(135deg, #f97316 0, #fb923c 100%)
        }

        .back-button {
            background: linear-gradient(135deg, #4b5563 0, #1f2937 100%)
        }

        .comparison-slider-wrapper {
            position: relative;
            width: 100%;
            max-width: 42rem;
            margin: 0 auto;
            border-radius: .5rem;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background-color: #fff;
            aspect-ratio: 1.6;
            overflow: hidden
        }

        .comparison-slider-wrapper>img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .comparison-slider {
            position: absolute;
            inset: 0;
            width: 50%;
            overflow: hidden;
            background-color: #fff
        }

        .comparison-slider img {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            object-fit: cover
        }

        .slider-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 6px;
            background: #abc3db;
            cursor: ew-resize;
            transform: translateX(-50%)
        }

        .slider-handle::before {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .3)
        }

        .slider-handle::after {
            position: absolute;
            content: '';
            width: 24px;
            height: 24px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234A5568' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M10 19l-7-7 7-7'/%3E%3Cpath d='M14 19l7-7-7-7'/%3E%3C/svg%3E") center/contain no-repeat
        }

        a {
            text-decoration: none
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1)
        }

        #downloadBtn {
            background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%) !important
        }

        #downloadBtn:hover {
            box-shadow: 0 4px 12px rgba(29, 78, 216, 0.3)
        }

        .highlight {
            background-color: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 1rem;
            border-radius: .5rem
        }

        .faq-question {
            transition: all .3s ease
        }

        .faq-question:hover {
            transform: translateX(8px)
        }

        .crop-buttons-container {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 10px
        }

        .crop-buttons-container button {
            min-width: 140px;
            padding: 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: opacity .3s
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
            padding: .75rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(147, 197, 253, 0.2)
        }

        .tool-button {
            display: flex;
            align-items: center;
            gap: .5rem;
            padding: .75rem 1.25rem;
            border-radius: .75rem;
            font-weight: 500;
            transition: all .2s;
            border: 1px solid transparent;
            background: #fff;
            color: #4b5563;
            cursor: pointer;
            min-width: 120px;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05)
        }

        .tool-button:hover {
            background: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)
        }

        .tool-button.active {
            background: #dbeafe;
            border-color: #93c5fd;
            color: #1e3a8a
        }

        .tool-button svg {
            width: 1.5rem;
            height: 1.5rem
        }

        .controls-panel {
            background: #fff;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-top: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(147, 197, 253, 0.2)
        }

        .controls-panel .buttons-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem
        }

        #enableCropBtn {
            background: #fae8ff;
            color: #9333ea;
            border-color: #e9d5ff
        }

        #enableCropBtn:hover,
        #enableCropBtn.active {
            background: #f3e8ff;
            border-color: #d8b4fe;
            color: #7e22ce
        }

        #enableBlurBtn,
        #applyDniProtectionBtn {
            background: #f0fdf4;
            color: #15803d;
            border-color: #dcfce7
        }

        #enableBlurBtn:hover,
        #applyDniProtectionBtn:hover,
        #enableBlurBtn.active,
        #applyDniProtectionBtn.active {
            background: #dcfce7;
            border-color: #86efac;
            color: #15803d
        }

        #nextToWatermarkBtn {
            background: #eff6ff;
            color: #2563eb;
            border-color: #dbeafe
        }

        #nextToWatermarkBtn:hover {
            background: #dbeafe;
            border-color: #93c5fd;
            color: #1d4ed8
        }

        #applyCropBtn {
            background: #f0fdf4;
            color: #065f46;
            border-color: #dcfce7
        }

        #applyCropBtn:hover {
            background: #dcfce7;
            border-color: #86efac;
            color: #15803d
        }

        #cancelCropBtn {
            background: #fef2f2;
            color: #7f1d1d;
            border-color: #fee2e2
        }

        #cancelCropBtn:hover {
            background: #fee2e2;
            border-color: #fca5a5;
            color: #b91c1c
        }

        #undoBlurBtn {
            background: #fff7ed;
            color: #9a3412;
            border-color: #ffedd5
        }

        #undoBlurBtn:hover:not(:disabled) {
            background: #ffedd5;
            border-color: #fed7aa;
            color: #c2410c
        }

        #undoBlurBtn:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        .slider-control {
            display: flex;
            flex-direction: column;
            gap: .5rem;
            margin-top: 1.5rem;
            background: #f8fafc;
            padding: 1rem;
            border-radius: .75rem;
            border: 1px solid rgba(147, 197, 253, 0.2)
        }

        .slider-control input[type="range"] {
            width: 100%;
            height: .5rem;
            -webkit-appearance: none;
            appearance: none;
            background: #e2e8f0;
            border-radius: .25rem;
            outline: none
        }

        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 1.5rem;
            height: 1.5rem;
            background: #3b82f6;
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: all .2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1)
        }

        .slider-control input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)
        }

        .slider-control label {
            color: #4b5563;
            font-weight: 500
        }

        #blurInstructions {
            background: #fcefdc42;
            color: #805215;
            padding: 1rem;
            margin-top: 1rem;
            text-align: center
        }

        /* DNI tools */

        #dniInstructions {
            background: #fcefdc42;
            color: #805215;
            padding: 1rem;
            margin-top: 1rem;
            text-align: center
        }

        .dni-tools-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: .5rem;
            margin-top: 1.5rem;
            margin-bottom: .5rem
        }

        .dni-tools-title {
            font-size: .75rem;
            text-transform: uppercase;
            letter-spacing: .05em;
            color: #6b7280;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: .35rem
        }

        .dni-tools-title-badge {
            font-size: .65rem;
            padding: .15rem .45rem;
            border-radius: 999px;
            background: #eff6ff;
            color: #1d4ed8;
            font-weight: 600
        }

        #toggleDniToolsBtn {
            padding: .4rem .8rem;
            border-radius: 999px;
            font-size: .75rem;
            min-width: auto;
            box-shadow: none;
            border: 1px solid #dbeafe;
            background: #eff6ff;
            color: #1d4ed8;
            display: inline-flex;
            align-items: center;
            gap: .3rem
        }

        #toggleDniToolsBtn svg {
            width: 0.9rem;
            height: 0.9rem
        }

        #toggleDniToolsBtn:hover {
            background: #dbeafe
        }

        .dni-preset-container {
            display: flex;
            flex-wrap: wrap;
            gap: .35rem;
            margin-bottom: .75rem;
            margin-top: .75rem
        }

        .dni-preset-button {
            border-radius: 999px;
            padding: .25rem .6rem;
            font-size: .7rem;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
            color: #4b5563;
            cursor: pointer;
            transition: all .15s ease-in-out
        }

        .dni-preset-button:hover {
            background: #eff6ff;
            border-color: #bfdbfe;
            color: #1d4ed8
        }

        .dni-preset-button.active {
            background: #1d4ed8;
            border-color: #1d4ed8;
            color: #fff
        }

        .dni-fields-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: .35rem .75rem;
        }

        .dni-fields-grid label {
            font-size: .78rem
        }

        .dni-section-divider {
            border-top: 1px dashed #e5e7eb;
            margin-top: .75rem;
            margin-bottom: .75rem
        }

        /* --- Base container --- */
        .dni-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 6px 0;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            user-select: none;
        }

        /* Hide default checkbox/radio styles */
        .dni-option input[type="checkbox"],
        .dni-option input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            margin: 0;
            margin-left: 15px;
            width: 20px;
            height: 20px;
            border: 2px solid #8a8a8a;
            border-radius: 4px;
            display: grid;
            place-content: center;
            background-color: white;
            transition: all 0.2s ease;
        }

        /* Radio uses circle */
        .dni-option input[type="radio"] {
            border-radius: 50%;
        }

        /* Hover */
        .dni-option:hover input {
            border-color: #4a9cff;
        }

        /* --- CHECKED states --- */
        .dni-option input[type="checkbox"]:checked {
            background-color: #4a9cff;
            border-color: #4a9cff;
        }

        .dni-option input[type="radio"]:checked {
            background-color: #4a9cff;
            border-color: #4a9cff;
        }

        /* Checkmark inside checkbox */
        .dni-option input[type="checkbox"]:checked::before {
            content: "✔";
            color: white;
            font-size: 14px;
            line-height: 1;
        }

        /* Dot inside radio button */
        .dni-option input[type="radio"]:checked::before {
            content: "";
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
        }

        /* Disabled state */
        .dni-option input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dni-option:has(input:disabled) {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @media (max-width: 640px) {
            .toolbar {
                gap: .75rem;
                padding: .75rem;
                flex-direction: column
            }

            .tool-button {
                width: 100%;
                padding: .75rem 1rem;
                justify-content: center
            }

            .tool-button svg {
                width: 1.25rem;
                height: 1.25rem
            }

            .controls-panel {
                padding: 1rem
            }

            .buttons-container {
                flex-direction: column;
                gap: .75rem
            }

            .buttons-container .tool-button {
                width: 100%
            }
        }
    </style>
</head>

<body class="flex flex-col items-center pt-8 pb-20">
    <div class="w-full max-w-4xl p-8 card rounded-2xl shadow-xl text-center mb-16 relative">
        <h1 class="text-4xl font-bold mb-8 text-gray-800">Comparte documentos con marca de agua</h1>
        <!-- Step 1: Upload and Text -->
        <div id="step1" class="space-y-6 step-transition">
            <label class="custom-file-upload block">
                <input type="file" id="imageInput" accept=".jpg,.jpeg,.png" class="hidden">
                <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>
                <p class="text-lg text-gray-600">Arrastra tu imagen o haz clic aquí para subirla</p>
                <p class="text-sm text-gray-500 mt-2">Soporta: JPG y PNG</p>
            </label>
            <div class="relative">
                <div class="relative">
                    <input type="text" id="watermarkText" maxlength="60"
                        placeholder="Introduce el texto de la marca de agua (máx. 60 caracteres)"
                        class="w-full p-4 pr-16 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-center text-lg">
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm text-gray-500">
                        <span id="charCount">0</span>/60
                    </span>
                </div>
                <p class="mt-2 text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
                    <strong>Consejo:</strong> Para mayor seguridad, incluye el nombre completo del destinatario y el
                    motivo específico (ej: "Para Juan Pérez - Validación de identidad en XYZ")
                </p>
            </div>

            <button id="nextToPreviewBtn"
                class="w-full gradient-button text-white py-4 rounded-lg text-lg font-semibold hover:opacity-90">
                Siguiente
            </button>

            <div class="mt-4 text-center">
                <p class="text-sm text-gray-600">Tu documento se procesa localmente, sin enviar información a servidores
                    externos.</p>
            </div>
        </div>

        <!-- Step 2: Preview and Blur -->
        <div id="step2" class="hidden step-transition">
            <div class="mb-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Editar imagen</h2>
                <div class="canvas-container">
                    <canvas id="originalCanvas" class="w-full cursor-crosshair"></canvas>
                </div>
            </div>

            <div class="toolbar">
                <button id="enableCropBtn" class="tool-button tooltip" data-tooltip="Recortar la imagen">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 4v16M17 4v16M3 8h18M3 16h18" />
                    </svg>
                    <span>Recortar imagen</span>
                </button>

                <button id="enableBlurBtn" class="tool-button tooltip" data-tooltip="Ocultar datos sensibles">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                    </svg>
                    <span>Ocultar datos</span>
                </button>

                <button id="nextToWatermarkBtn" class="tool-button tooltip"
                    data-tooltip="Continuar con la marca de agua">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Aplicar marca de agua</span>
                </button>
            </div>

            <div id="cropControls" class="controls-panel hidden">
                <p class="text-sm font-medium text-gray-700 mb-4 text-center">Arrastra las esquinas azules para ajustar
                    el área de recorte</p>
                <div class="buttons-container">
                    <button id="applyCropBtn" class="tool-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span>Aplicar</span>
                    </button>
                    <button id="cancelCropBtn" class="tool-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        <span>Cancelar</span>
                    </button>
                </div>
            </div>
            <div id="blurInstructions" class="bg-blue-50 text-blue-700 p-4 rounded-lg mt-4 hidden">
                Haz clic y arrastra para ocultar áreas sensibles.<br /><span style="font-size: 0.8rem;">Ejemplo: Número
                    de trámite, Códigos de barras/QR, etc.</span>
            </div>
            <div id="blurControls" class="controls-panel hidden">

                <button id="undoBlurBtn" class="tool-button w-full" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                    </svg>
                    <span>Deshacer última ofuscación</span>
                </button>

                <div class="slider-control">
                    <label for="cursorSize" class="text-sm font-medium text-gray-700">
                        Tamaño del cursor: <span id="cursorSizeValue">10</span>px
                    </label>
                    <input type="range" id="cursorSize" min="5" max="50" value="10">
                </div>

                <!-- Cabecera Herramientas DNI -->
                <div id="toggleDniTools" class="dni-tools-header">
                    <div class="dni-tools-title">
                        Herramientas de DNI
                        <span class="dni-tools-title-badge">Beta</span>
                    </div>
                    <button id="toggleDniToolsBtn" type="button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h10" />
                        </svg>
                        <span>Mostrar</span>
                    </button>
                </div>

                <!-- Contenedor Herramientas DNI (oculto por defecto) -->
                <div id="dniToolsContainer" class="hidden">
                    <div class="dni-section-divider"></div>

                    <!-- Lado del documento -->
                    <div class="mb-2 mt-1">
                        <p class="text-xs font-semibold text-gray-600 mb-1">Lado del documento</p>
                        <div class="flex items-center gap-4 text-sm text-gray-700 mb-2">
                            <label class="flex items-center gap-2 dni-option">
                                <input type="radio" name="dniSide" id="dniSideFront" value="front" checked>
                                <span>Anverso</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="radio" name="dniSide" id="dniSideBack" value="back">
                                <span>Reverso</span>
                            </label>
                        </div>
                    </div>

                    <!-- Filtros rápidos -->
                    <div class="mb-2 mt-1">
                        <p class="text-xs font-semibold text-gray-600 mb-1">Filtros rápidos</p>
                        <div class="flex items-center gap-4 text-sm text-gray-700 mb-2">
                            <div class="dni-preset-container">
                                <button type="button" class="dni-preset-button" data-preset="all">
                                    Todos
                                </button>
                                <button type="button" class="dni-preset-button" data-preset="none">
                                    Ninguno
                                </button>
                                <button type="button" class="dni-preset-button" data-preset="hotel">
                                    Hotel
                                </button>
                                <button type="button" class="dni-preset-button" data-preset="invoice">
                                    Factura
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Opciones anverso -->
                    <div id="dniFrontOptions" class="mt-3">
                        <p class="text-xs font-semibold text-gray-600 mb-2">Ocultar campos del anverso</p>
                        <div class="dni-fields-grid text-sm text-gray-700 mb-6">
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideNumber" checked>
                                <span>Número de DNI</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHidePhoto">
                                <span>Fotografía</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideLastName" checked>
                                <span>Apellidos</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideFirstName" checked>
                                <span>Nombre</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideSex">
                                <span>Sexo</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideNationality">
                                <span>Nacionalidad</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideBirth">
                                <span>Nacimiento</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideIssue">
                                <span>Emisión</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideExpiry">
                                <span>Validez</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideSupport">
                                <span>Soporte</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideSignature">
                                <span>Firma</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideCAN">
                                <span>CAN</span>
                            </label>
                        </div>
                    </div>

                    <!-- Opciones reverso -->
                    <div id="dniBackOptions" class="mt-3 hidden">
                        <p class="text-xs font-semibold text-gray-600 mb-2">Ocultar campos del reverso</p>
                        <div class="dni-fields-grid text-sm text-gray-700 mb-6">
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideTeam">
                                <span>Equipo</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideAddressBack" checked>
                                <span>Domicilio</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideBirthPlace">
                                <span>Lugar de nacimiento</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideParents">
                                <span>Padres</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideMRZ">
                                <span>MRZ</span>
                            </label>
                            <label class="flex items-center gap-2 dni-option">
                                <input type="checkbox" id="dniHideSupport2">
                                <span>Soporte</span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-3 text-left mb-6">
                        <label class="flex items-center gap-2 text-xs text-gray-700 dni-option">
                            <input type="checkbox" id="dniApplyBw" checked>
                            <span>Convertir DNI a blanco y negro (recomendado)</span>
                        </label>
                    </div>

                    <button id="applyDniProtectionBtn" class="tool-button w-full mt-4">
                        Aplicar protección de DNI
                    </button>
                    <p class="mt-2 text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
                        <strong>Consejo:</strong> Para mejores resultados, intenta que el DNI esté lo más recto posible.
                        Recuerda que también puedes pintar sobre la imagen si algún detalle queda visible.
                    </p>
                </div>
            </div>
        </div>

        <!-- Step 3: Final Result -->
        <div id="step3" class="hidden step-transition">
            <div class="mb-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Resultado</h2>
                <div class="canvas-container">
                    <canvas id="canvas" class="w-full"></canvas>
                </div>
            </div>
            <button id="downloadBtn" class="w-full gradient-button text-white py-4 rounded-lg text-lg font-semibold">
                Descargar imagen
            </button>
            <a href="#" id="startOverBtn"
                class="block mt-12 text-gray-600 hover:text-gray-800 text-base transition-colors duration-200">
                Volver a empezar
            </a>
        </div>
    </div>

    <script>
        /**
         * SAFE ID - Herramienta de Protección de DNI
         */

        // Referencias a elementos del DOM para la interfaz de usuario
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const nextToPreviewBtn = document.getElementById('nextToPreviewBtn');
        const nextToWatermarkBtn = document.getElementById('nextToWatermarkBtn');
        const enableBlurBtn = document.getElementById('enableBlurBtn');
        const startOverBtn = document.getElementById('startOverBtn');
        const blurInstructions = document.getElementById('blurInstructions');

        /**
         * Configuración de los canvases para el procesamiento de imágenes
         */
        const originalCanvas = document.getElementById('originalCanvas');
        const originalCtx = originalCanvas.getContext('2d', { willReadFrequently: true });
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });

        let img = new Image();
        let painting = false;
        let blurEnabled = false;

        originalCtx.imageSmoothingEnabled = true;
        originalCtx.imageSmoothingQuality = 'high';
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';

        // Marca de agua
        const watermarkInput = document.getElementById('watermarkText');
        const charCount = document.getElementById('charCount');

        watermarkInput.addEventListener('input', function () {
            charCount.textContent = this.value.length;
        });

        // Carga de imagen
        document.getElementById('imageInput').addEventListener('change', function (e) {
            if (e.target.files[0]) {
                const file = e.target.files[0];
                const fileLabel = this.parentElement.querySelector('p');

                const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    alert('Por favor sube un archivo en formato JPG o PNG.');
                    this.value = '';
                    return;
                }

                fileLabel.textContent = file.name;

                const reader = new FileReader();
                reader.onload = function (e) {
                    const previewImg = document.createElement('img');
                    previewImg.src = e.target.result;
                    previewImg.classList.add('mx-auto', 'mt-4', 'max-h-40', 'rounded-lg');

                    const existingPreview = fileLabel.parentElement.querySelector('img');
                    if (existingPreview) {
                        existingPreview.remove();
                    }

                    fileLabel.parentElement.appendChild(previewImg);
                };
                reader.readAsDataURL(file);
            }
        });

        function showStep(stepToShow) {
            const steps = [step1, step2, step3];

            for (const step of steps) {
                if (step === stepToShow) {
                    step.classList.remove('hidden');
                    step.classList.add('step-enter');
                    setTimeout(() => step.classList.add('step-enter-active'), 10);
                } else {
                    step.classList.add('hidden');
                    step.classList.remove('step-enter', 'step-enter-active');
                }
            }
        }

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                img = new Image();
                img.onload = function () {
                    originalCanvas.width = canvas.width = img.width;
                    originalCanvas.height = canvas.height = img.height;
                    originalCtx.drawImage(img, 0, 0, img.width, img.height);
                    ctx.drawImage(img, 0, 0, img.width, img.height);

                    originalCanvas.style.width = canvas.style.width = '100%';
                    originalCanvas.style.height = canvas.style.height = 'auto';
                    originalCanvas.style.maxWidth = canvas.style.maxWidth = '100%';
                };
                img.onerror = function () {
                    alert('Error al cargar la imagen. Por favor intenta con otro archivo.');
                };
                img.src = e.target.result;
            };
            reader.onerror = function () {
                alert('Error al leer el archivo. Por favor intenta de nuevo.');
            };
            reader.readAsDataURL(file);
        }

        nextToPreviewBtn.addEventListener('click', () => {
            const imageInput = document.getElementById('imageInput');
            const watermarkText = watermarkInput.value;

            if (!imageInput.files[0]) {
                alert('Por favor, sube una imagen primero.');
                return;
            }
            if (!watermarkText.trim()) {
                alert('Por favor, introduce el texto de la marca de agua.');
                return;
            }
            if (watermarkText.length > 60) {
                alert('El texto de la marca de agua debe tener 60 caracteres o menos.');
                return;
            }

            loadImage(imageInput.files[0]);
            showStep(step2);
        });

        /**
         * Recorte
         */
        let cropEnabled = false;
        let cropBox = null;
        let originalImageData = null;
        let corners = [];

        const enableCropBtn = document.getElementById('enableCropBtn');
        const cropControls = document.getElementById('cropControls');
        const applyCropBtn = document.getElementById('applyCropBtn');
        const cancelCropBtn = document.getElementById('cancelCropBtn');

        function createCropBox() {
            cropBox = document.createElement('div');
            cropBox.style.position = 'absolute';
            cropBox.style.width = '100%';
            cropBox.style.height = '100%';
            cropBox.style.top = '0';
            cropBox.style.left = '0';
            cropBox.style.pointerEvents = 'none';

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.style.position = 'absolute';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.pointerEvents = 'none';
            svg.setAttribute('viewBox', '0 0 100 100');
            svg.setAttribute('preserveAspectRatio', 'none');

            const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            polygon.setAttribute('fill', 'rgba(6, 182, 212, 0.1)');
            polygon.setAttribute('stroke', '#06b6d4');
            polygon.setAttribute('stroke-width', '0.5');
            polygon.style.pointerEvents = 'none';
            svg.appendChild(polygon);
            cropBox.appendChild(svg);

            const canvasContainer = originalCanvas.parentElement;
            canvasContainer.style.position = 'relative';
            canvasContainer.appendChild(cropBox);

            const rect = originalCanvas.getBoundingClientRect();
            const padding = Math.min(rect.width, rect.height) * 0.1;

            corners = [
                { x: padding / rect.width, y: padding / rect.height },
                { x: (rect.width - padding) / rect.width, y: padding / rect.height },
                { x: (rect.width - padding) / rect.width, y: (rect.height - padding) / rect.height },
                { x: padding / rect.width, y: (rect.height - padding) / rect.height }
            ];

            for (const [index, corner] of corners.entries()) {
                const handle = document.createElement('div');
                handle.className = 'corner-handle';
                handle.style.position = 'absolute';
                handle.style.width = '20px';
                handle.style.height = '20px';
                handle.style.backgroundColor = '#06b6d4';
                handle.style.border = '2px solid white';
                handle.style.borderRadius = '50%';
                handle.style.cursor = 'move';
                handle.style.zIndex = '10';
                handle.style.transform = 'translate(-50%, -50%)';
                handle.style.pointerEvents = 'auto';
                handle.style.touchAction = 'none';

                handle.style.left = `${corner.x * 100}%`;
                handle.style.top = `${corner.y * 100}%`;

                handle.addEventListener('mousedown', handleDragStart);
                handle.addEventListener('touchstart', handleDragStart, { passive: false });

                function handleDragStart(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const rect = originalCanvas.getBoundingClientRect();

                    function moveHandle(e) {
                        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

                        const x = Math.min(Math.max(0, (clientX - rect.left) / rect.width), 1);
                        const y = Math.min(Math.max(0, (clientY - rect.top) / rect.height), 1);

                        corners[index] = { x, y };
                        handle.style.left = `${x * 100}%`;
                        handle.style.top = `${y * 100}%`;

                        updatePolygon();
                    }

                    function stopMoving() {
                        document.removeEventListener('mousemove', moveHandle);
                        document.removeEventListener('mouseup', stopMoving);
                        document.removeEventListener('touchmove', moveHandle);
                        document.removeEventListener('touchend', stopMoving);
                    }

                    document.addEventListener('mousemove', moveHandle);
                    document.addEventListener('mouseup', stopMoving);
                    document.addEventListener('touchmove', moveHandle, { passive: false });
                    document.addEventListener('touchend', stopMoving);
                }

                cropBox.appendChild(handle);
            }

            updatePolygon();
        }

        function updatePolygon() {
            if (!cropBox) return;

            const polygon = cropBox.querySelector('polygon');
            if (polygon) {
                const pointsStr = corners.map(corner => {
                    const x = corner.x * 100;
                    const y = corner.y * 100;
                    return `${x},${y}`;
                }).join(' ');
                polygon.setAttribute('points', pointsStr);
            }
        }

        function disableCropMode() {
            cropEnabled = false;
            enableCropBtn.classList.remove('opacity-75');
            cropControls.classList.add('hidden');

            if (cropBox) {
                cropBox.remove();
                cropBox = null;
            }

            enableBlurBtn.style.display = 'inherit';
        }

        function enableCropMode() {
            cropEnabled = true;
            enableCropBtn.classList.add('opacity-75');
            cropControls.classList.remove('hidden');
            originalImageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);
            createCropBox();

            if (blurEnabled) {
                blurEnabled = false;
                blurInstructions.style.display = 'none';
                blurControls.classList.add('hidden');
            }
            enableBlurBtn.style.display = 'none';
        }

        function applyCrop() {
            if (!cropBox) return;

            const points = corners.map(corner => ({
                x: corner.x * originalCanvas.width,
                y: corner.y * originalCanvas.height
            }));

            const minX = Math.min(...points.map(p => p.x));
            const maxX = Math.max(...points.map(p => p.x));
            const minY = Math.min(...points.map(p => p.y));
            const maxY = Math.max(...points.map(p => p.y));

            const newWidth = maxX - minX;
            const newHeight = maxY - minY;

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = originalCanvas.width;
            tempCanvas.height = originalCanvas.height;
            const tempCtx = tempCanvas.getContext('2d');

            tempCtx.drawImage(originalCanvas, 0, 0);

            originalCanvas.width = newWidth;
            originalCanvas.height = newHeight;

            originalCtx.clearRect(0, 0, newWidth, newHeight);
            originalCtx.save();
            originalCtx.beginPath();

            let index = 0;
            for (const point of points) {
                const x = point.x - minX;
                const y = point.y - minY;

                if (index === 0) {
                    originalCtx.moveTo(x, y);
                } else {
                    originalCtx.lineTo(x, y);
                }

                index++;
            }

            originalCtx.closePath();
            originalCtx.clip();

            originalCtx.drawImage(tempCanvas, -minX, -minY);
            originalCtx.restore();

            originalCanvas.style.width = '100%';
            originalCanvas.style.height = 'auto';
            originalCanvas.style.maxWidth = '100%';

            disableCropMode();
        }

        enableCropBtn.addEventListener('click', () => {
            if (cropEnabled) {
                if (originalImageData) {
                    originalCtx.putImageData(originalImageData, 0, 0);
                }
                disableCropMode();
            } else {
                enableCropMode();
            }
        });

        applyCropBtn.addEventListener('click', applyCrop);
        cancelCropBtn.addEventListener('click', () => {
            if (originalImageData) {
                originalCtx.putImageData(originalImageData, 0, 0);
            }
            disableCropMode();
        });

        const cropInstructions = document.querySelector('#cropControls p');
        cropInstructions.textContent = 'Arrastra las esquinas azules para ajustar el área de recorte.';

        /**
         * Ofuscación (pincel) + historial
         */
        const cursorSize = document.getElementById('cursorSize');
        const cursorSizeValue = document.getElementById('cursorSizeValue');
        const blurControls = document.getElementById('blurControls');

        let canvasStateHistory = [];
        let currentStateIndex = -1;
        const MAX_HISTORY_STATES = 20;
        let strokeInProgress = false;

        function saveCanvasState() {
            if (!originalCanvas.width || !originalCanvas.height) return;

            if (!strokeInProgress) {
                canvasStateHistory = canvasStateHistory.slice(0, currentStateIndex + 1);

                const imageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);

                if (canvasStateHistory.length >= MAX_HISTORY_STATES) {
                    canvasStateHistory.shift();
                    currentStateIndex--;
                }

                canvasStateHistory.push(imageData);
                currentStateIndex++;

                document.getElementById('undoBlurBtn').disabled = currentStateIndex <= 0;
            }
        }

        function undoBlur() {
            if (currentStateIndex > 0) {
                currentStateIndex--;
                const previousState = canvasStateHistory[currentStateIndex];
                originalCtx.putImageData(previousState, 0, 0);

                document.getElementById('undoBlurBtn').disabled = currentStateIndex <= 0;
            }
        }

        cursorSize.addEventListener('input', function () {
            cursorSizeValue.textContent = this.value;
        });

        enableBlurBtn.addEventListener('click', () => {
            blurEnabled = !blurEnabled;
            blurInstructions.style.display = blurEnabled ? 'block' : 'none';
            blurControls.classList.toggle('hidden');
            enableBlurBtn.classList.toggle('opacity-75');

            if (blurEnabled) {
                canvasStateHistory = [];
                currentStateIndex = -1;
                saveCanvasState();

                if ('ontouchstart' in globalThis) {
                    blurInstructions.innerHTML = 'Toca y arrastra para ocultar áreas sensibles, luego aplica la marca de agua<br /><span style="font-size: 0.8rem;">Ejemplo: Número de trámite, Códigos de barras/QR, Información innecesaria.</span>';
                }
            }
        });

        document.getElementById('undoBlurBtn').addEventListener('click', undoBlur);

        originalCanvas.addEventListener('mousedown', (event) => {
            if (blurEnabled) {
                painting = true;
                blurAtMouse(event);
            }
        });

        originalCanvas.addEventListener('mouseup', () => {
            painting = false;
            if (strokeInProgress) {
                strokeInProgress = false;
                saveCanvasState();
            }
        });

        originalCanvas.addEventListener('mousemove', (event) => {
            if (painting && blurEnabled) {
                blurAtMouse(event);
            }
        });

        originalCanvas.addEventListener('touchstart', (event) => {
            if (blurEnabled) {
                event.preventDefault();
                painting = true;
                blurAtTouch(event);
            }
        });

        originalCanvas.addEventListener('touchend', (event) => {
            event.preventDefault();
            painting = false;
            if (strokeInProgress) {
                strokeInProgress = false;
                saveCanvasState();
            }
        });

        originalCanvas.addEventListener('touchmove', (event) => {
            if (painting && blurEnabled) {
                event.preventDefault();
                blurAtTouch(event);
            }
        });

        function blurAtMouse(event) {
            const rect = originalCanvas.getBoundingClientRect();
            const scaleX = originalCanvas.width / rect.width;
            const scaleY = originalCanvas.height / rect.height;
            const x = (event.clientX - rect.left) * scaleX;
            const y = (event.clientY - rect.top) * scaleY;
            applyRedactBrush(x, y);
        }

        function blurAtTouch(event) {
            const rect = originalCanvas.getBoundingClientRect();
            const scaleX = originalCanvas.width / rect.width;
            const scaleY = originalCanvas.height / rect.height;
            const touch = event.touches[0];
            const x = (touch.clientX - rect.left) * scaleX;
            const y = (touch.clientY - rect.top) * scaleY;
            applyRedactBrush(x, y);
        }

        function applyRedactBrush(x, y) {
            if (!strokeInProgress) {
                saveCanvasState();
                strokeInProgress = true;
            }

            const radius = Number.parseInt(cursorSize.value);

            originalCtx.save();
            originalCtx.globalCompositeOperation = 'source-over';
            originalCtx.fillStyle = '#000000';
            originalCtx.beginPath();
            originalCtx.arc(x, y, radius, 0, Math.PI * 2);
            originalCtx.fill();
            originalCtx.restore();
        }

        /**
         * Herramientas DNI
         */

        const dniSideFrontRadio = document.getElementById('dniSideFront');
        const dniSideBackRadio = document.getElementById('dniSideBack');
        const dniFrontOptions = document.getElementById('dniFrontOptions');
        const dniBackOptions = document.getElementById('dniBackOptions');
        const applyDniProtectionBtn = document.getElementById('applyDniProtectionBtn');
        const toggleDniTools = document.getElementById('toggleDniTools');
        const dniToolsContainer = document.getElementById('dniToolsContainer');
        const dniPresetButtons = document.querySelectorAll('.dni-preset-button');

        toggleDniTools.addEventListener('click', () => {
            const isHidden = dniToolsContainer.classList.contains('hidden');
            if (isHidden) {
                dniToolsContainer.classList.remove('hidden');
                toggleDniToolsBtn.classList.add('opacity-75');
                toggleDniToolsBtn.querySelector('span').textContent = 'Ocultar';
            } else {
                dniToolsContainer.classList.add('hidden');
                toggleDniToolsBtn.classList.remove('opacity-75');
                toggleDniToolsBtn.querySelector('span').textContent = 'Mostrar';
            }
        });

        dniSideFrontRadio.addEventListener('change', toggleDniSide);
        dniSideBackRadio.addEventListener('change', toggleDniSide);

        function toggleDniSide() {
            if (dniSideFrontRadio.checked) {
                dniFrontOptions.classList.remove('hidden');
                dniBackOptions.classList.add('hidden');
            } else {
                dniFrontOptions.classList.add('hidden');
                dniBackOptions.classList.remove('hidden');
            }
        }

        const dniTemplateFront = {
            number: { x: 0.4294, y: 0.1755, w: 0.3264, h: 0.0812 },
            number_2: { x: 0.0262, y: 0.188, w: 0.1787, h: 0.0752 },
            photo: { x: 0.038, y: 0.227, w: 0.3327, h: 0.7226 },
            photo_2: { x: 0.8322, y: 0.6235, w: 0.0597, h: 0.1321 },
            lastName: { x: 0.38, y: 0.2883, w: 0.5703, h: 0.1109 },
            firstName: { x: 0.38, y: 0.4348, w: 0.5703, h: 0.0643 },
            sex: { x: 0.38, y: 0.5219, w: 0.0638, h: 0.0643 },
            nationality: { x: 0.5157, y: 0.5219, w: 0.1263, h: 0.0643 },
            birth: { x: 0.7808, y: 0.5219, w: 0.1901, h: 0.0643 },
            issue: { x: 0.38, y: 0.606, w: 0.1913, h: 0.0643 },
            issue_2: { x: 0.7973, y: 0.6691, w: 0.1362, h: 0.0614 },
            expiry: { x: 0.577, y: 0.606, w: 0.1914, h: 0.0643 },
            support: { x: 0.38, y: 0.6981, w: 0.1801, h: 0.0643 },
            support_2: { x: 0.7633, y: 0.1757, w: 0.1076, h: 0.0653 },
            signature: { x: 0.38, y: 0.7596, w: 0.3589, h: 0.1464 },
            can: { x: 0.7658, y: 0.8129, w: 0.1976, h: 0.0891 }
        };

        const dniTemplateBack = {
            team: { x: 0.0286, y: 0.2617, w: 0.0497, h: 0.2929 },
            support_3: { x: 0.1231, y: 0.1418, w: 0.1156, h: 0.0708 },
            address: { x: 0.2772, y: 0.0829, w: 0.6714, h: 0.2182 },
            birthPlace: { x: 0.2772, y: 0.3463, w: 0.6714, h: 0.1396 },
            parents: { x: 0.2772, y: 0.5173, w: 0.6714, h: 0.0708 },
            mrz: { x: 0.0286, y: 0.649, w: 0.92, h: 0.2595 }
        };

        function dniDebug() {
            let clicks = [];

            originalCanvas.addEventListener('click', onClick);
            return "DNI debug activated. Click on the four corners of the area to get the template.";

            function onClick(event) {
                const rect = originalCanvas.getBoundingClientRect();
                const scaleX = originalCanvas.width / rect.width;
                const scaleY = originalCanvas.height / rect.height;

                const realX = (event.clientX - rect.left) * scaleX;
                const realY = (event.clientY - rect.top) * scaleY;

                clicks.push({ x: realX, y: realY });

                console.log(`Click ${clicks.length}/4 →`, realX.toFixed(1), realY.toFixed(1));

                if (clicks.length === 4) {
                    processPoints();
                    clicks = []; // reset for next measurement
                }
            }

            function processPoints() {
                const box = detectDniBox();
                if (!box) {
                    console.warn("DNI box not detected.");
                    return;
                }

                // Extract points
                const tl = clicks[0];
                const tr = clicks[1];
                const bl = clicks[2];
                const br = clicks[3];

                // Compute bounding rectangle from the clicked points
                const minX = Math.min(tl.x, bl.x);
                const maxX = Math.max(tr.x, br.x);
                const minY = Math.min(tl.y, tr.y);
                const maxY = Math.max(bl.y, br.y);

                const absX = minX;
                const absY = minY;
                const absW = maxX - minX;
                const absH = maxY - minY;

                // Normalize
                const normX = (absX - box.x) / box.w;
                const normY = (absY - box.y) / box.h;
                const normW = absW / box.w;
                const normH = absH / box.h;

                // Output final block
                console.log(`{x: ${normX.toFixed(4)}, y: ${normY.toFixed(4)}, w: ${normW.toFixed(4)}, h: ${normH.toFixed(4)}}`);
            }
        }

        function detectDniBox(threshold = 240, step = 4, alphaThreshold = 10) {
            const width = originalCanvas.width;
            const height = originalCanvas.height;
            if (!width || !height) {
                return { x: 0, y: 0, w: 0, h: 0 };
            }

            const imageData = originalCtx.getImageData(0, 0, width, height);
            const data = imageData.data;

            let minX = width, minY = height, maxX = 0, maxY = 0;
            let found = false;

            for (let y = 0; y < height; y += step) {
                for (let x = 0; x < width; x += step) {
                    const idx = (y * width + x) * 4;
                    const r = data[idx];
                    const g = data[idx + 1];
                    const b = data[idx + 2];
                    const a = data[idx + 3]; // alpha

                    // Ignore fully or almost transparent pixels
                    if (a < alphaThreshold) continue;

                    const lum = 0.299 * r + 0.587 * g + 0.114 * b;

                    if (lum < threshold) {
                        found = true;
                        if (x < minX) minX = x;
                        if (y < minY) minY = y;
                        if (x > maxX) maxX = x;
                        if (y > maxY) maxY = y;
                    }
                }
            }

            // If nothing was found in opaque pixels, return full canvas
            if (!found) {
                return { x: 0, y: 0, w: width, h: height };
            }

            const padding = Math.min(width, height) * 0.01;
            minX = Math.max(0, minX - padding);
            minY = Math.max(0, minY - padding);
            maxX = Math.min(width, maxX + padding);
            maxY = Math.min(height, maxY + padding);

            return {
                x: minX,
                y: minY,
                w: maxX - minX,
                h: maxY - minY
            };
        }

        function redactZoneInBox(zone, box) {
            if (!box || box.w === 0 || box.h === 0) return;

            const x = box.x + zone.x * box.w;
            const y = box.y + zone.y * box.h;
            const w = zone.w * box.w;
            const h = zone.h * box.h;

            originalCtx.save();
            originalCtx.globalCompositeOperation = 'source-over';
            originalCtx.fillStyle = '#000000';
            originalCtx.fillRect(x, y, w, h);
            originalCtx.restore();
        }

        function applyDniProtection() {
            if (!originalCanvas.width || !originalCanvas.height) return;

            saveCanvasState();

            // Si el checkbox está marcado, pasamos a B/N
            const bwCheckbox = document.getElementById('dniApplyBw');
            if (bwCheckbox && bwCheckbox.checked) {
                applyBlackAndWhite();
            }

            const box = detectDniBox();

            if (dniSideFrontRadio.checked) {
                const hideNumber = document.getElementById('dniHideNumber').checked;
                const hidePhoto = document.getElementById('dniHidePhoto').checked;
                const hideLastName = document.getElementById('dniHideLastName').checked;
                const hideFirstName = document.getElementById('dniHideFirstName').checked;
                const hideSex = document.getElementById('dniHideSex').checked;
                const hideNationality = document.getElementById('dniHideNationality').checked;
                const hideSupport = document.getElementById('dniHideSupport').checked;
                const hideBirth = document.getElementById('dniHideBirth').checked;
                const hideIssue = document.getElementById('dniHideIssue').checked;
                const hideExpiry = document.getElementById('dniHideExpiry').checked;
                const hideSignature = document.getElementById('dniHideSignature').checked;
                const hideCAN = document.getElementById('dniHideCAN').checked;

                if (hideNumber) {
                    redactZoneInBox(dniTemplateFront.number, box);
                    redactZoneInBox(dniTemplateFront.number_2, box);
                }
                if (hidePhoto) {
                    redactZoneInBox(dniTemplateFront.photo, box);
                    redactZoneInBox(dniTemplateFront.photo_2, box);
                }
                if (hideLastName) redactZoneInBox(dniTemplateFront.lastName, box);
                if (hideFirstName) redactZoneInBox(dniTemplateFront.firstName, box);
                if (hideSex) redactZoneInBox(dniTemplateFront.sex, box);
                if (hideNationality) redactZoneInBox(dniTemplateFront.nationality, box);
                if (hideBirth) redactZoneInBox(dniTemplateFront.birth, box);
                if (hideIssue) {
                    redactZoneInBox(dniTemplateFront.issue, box);
                    redactZoneInBox(dniTemplateFront.issue_2, box);
                }
                if (hideExpiry) redactZoneInBox(dniTemplateFront.expiry, box);
                if (hideSupport) {
                    redactZoneInBox(dniTemplateFront.support, box);
                    redactZoneInBox(dniTemplateFront.support_2, box);
                }
                if (hideSignature) redactZoneInBox(dniTemplateFront.signature, box);
                if (hideCAN) redactZoneInBox(dniTemplateFront.can, box);
            } else {
                const hideTeam = document.getElementById('dniHideTeam').checked;
                const hideAddressBack = document.getElementById('dniHideAddressBack').checked;
                const hideBirthPlace = document.getElementById('dniHideBirthPlace').checked;
                const hideParents = document.getElementById('dniHideParents').checked;
                const hideMRZ = document.getElementById('dniHideMRZ').checked;
                const hideSupport2 = document.getElementById('dniHideSupport2').checked;

                if (hideTeam) redactZoneInBox(dniTemplateBack.team, box);
                if (hideAddressBack) redactZoneInBox(dniTemplateBack.address, box);
                if (hideBirthPlace) redactZoneInBox(dniTemplateBack.birthPlace, box);
                if (hideParents) redactZoneInBox(dniTemplateBack.parents, box);
                if (hideMRZ) redactZoneInBox(dniTemplateBack.mrz, box);
                if (hideSupport2) {
                    redactZoneInBox(dniTemplateBack.support_3, box);
                }
            }

            document.getElementById('undoBlurBtn').disabled = currentStateIndex <= 0;
        }

        applyDniProtectionBtn.addEventListener('click', () => {
            applyDniProtection();
        });

        // ---- Filtros rápidos (presets) ----

        const allDniCheckboxIds = [
            'dniHideNumber', 'dniHidePhoto', 'dniHideLastName', 'dniHideFirstName',
            'dniHideSex', 'dniHideNationality', 'dniHideBirth', 'dniHideIssue',
            'dniHideExpiry', 'dniHideSupport', 'dniHideSupport2', 'dniHideSignature', 'dniHideCAN',
            'dniHideTeam', 'dniHideAddressBack', 'dniHideBirthPlace',
            'dniHideParents', 'dniHideMRZ'
        ];

        function setAllDniCheckboxes(value) {
            for (const id of allDniCheckboxIds) {
                const el = document.getElementById(id);
                if (el) el.checked = value;
            }
        }

        function applyDniPreset(preset) {
            // Estilo visual de los botones
            for (const btn of dniPresetButtons) {
                if (btn.dataset.preset === preset) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            }

            // Por defecto: desmarcar todas las casillas
            setAllDniCheckboxes(false);

            // Según preset, marcamos los campos sensibles
            switch (preset) {

                case 'all':
                    setAllDniCheckboxes(true);
                    break;

                case 'none':
                    setAllDniCheckboxes(false);
                    break;

                case 'hotel':
                    setAllDniCheckboxes(true);
                    // Anverso
                    document.getElementById('dniHideFirstName').checked = false;
                    document.getElementById('dniHideLastName').checked = false;
                    document.getElementById('dniHideNumber').checked = false;
                    document.getElementById('dniHideSupport').checked = false;
                    document.getElementById('dniHideSex').checked = false;
                    document.getElementById('dniHideNationality').checked = false;
                    document.getElementById('dniHideBirth').checked = false;
                    // Reverso
                    document.getElementById('dniHideAddressBack').checked = false;
                    document.getElementById('dniHideSupport2').checked = false;
                    break;

                case 'invoice':
                    setAllDniCheckboxes(true);
                    // Anverso
                    document.getElementById('dniHideFirstName').checked = false;
                    document.getElementById('dniHideLastName').checked = false;
                    document.getElementById('dniHideNumber').checked = false;
                    // Reverso
                    document.getElementById('dniHideAddressBack').checked = false;
                    break;
            }
        }

        function applyBlackAndWhite() {
            const width = originalCanvas.width;
            const height = originalCanvas.height;
            const imgData = originalCtx.getImageData(0, 0, width, height);
            const data = imgData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // Fórmula estándar de luminancia
                const gray = 0.299 * r + 0.587 * g + 0.114 * b;

                data[i] = gray; // R
                data[i + 1] = gray; // G
                data[i + 2] = gray; // B
                // Alfa lo dejamos igual
            }

            originalCtx.putImageData(imgData, 0, 0);

            if (typeof saveCanvasState === "function") {
                saveCanvasState();
            }
        }

        for (const btn of dniPresetButtons) {
            btn.addEventListener('click', () => {
                applyDniPreset(btn.dataset.preset);
            });
        }

        // Navegación
        nextToWatermarkBtn.addEventListener('click', () => {
            showStep(step3);
            applyWatermark();
        });

        startOverBtn.addEventListener('click', (e) => {
            e.preventDefault();
            location.reload();
        });

        // Descarga
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'resultado.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        /**
         * Marca de agua
         */
        function applyWatermark() {
            const watermarkText = watermarkInput.value;

            canvas.width = originalCanvas.width;
            canvas.height = originalCanvas.height;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalCanvas, 0, 0);

            canvas.style.width = '100%';
            canvas.style.height = 'auto';
            canvas.style.maxWidth = '100%';

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            }
            ctx.putImageData(imageData, 0, 0);

            const minFontSize = 8;
            const maxFontSize = 22;
            const baseFontSize = Math.min(canvas.width, canvas.height) / 40;
            const fontSize = Math.min(maxFontSize, Math.max(minFontSize, baseFontSize));

            ctx.font = `${fontSize}px Arial`;
            ctx.textAlign = 'center';

            const textWidth = ctx.measureText(watermarkText).width;
            const horizontalSpacing = textWidth * 1.2;
            const verticalSpacing = fontSize * 1.2;

            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(-Math.PI / 6);
            ctx.translate(-canvas.width / 2, -canvas.height / 2);

            const diagonal = Math.hypot(canvas.width, canvas.height);
            const startX = -diagonal / 2;
            const startY = -diagonal / 2;
            const endX = diagonal * 1.5;
            const endY = diagonal * 1.5;

            const drawWavyText = (text, x, y, amplitude, frequency) => {
                const characters = text.split('');
                const prevAlign = ctx.textAlign;
                ctx.textAlign = 'left';

                let currentX = x - (textWidth / 2);
                const baselineY = y;

                for (const char of characters) {
                    const charWidth = ctx.measureText(char).width;
                    const waveX = currentX + (charWidth / 2);
                    const yOffset = amplitude * Math.sin(frequency * waveX + baselineY * 0.05);
                    const xOffset = amplitude * 0.3 * Math.cos(frequency * waveX + baselineY * 0.05);

                    ctx.globalAlpha = 0.1;
                    ctx.fillText(char, currentX + xOffset + 1, baselineY + yOffset + 1);

                    ctx.globalAlpha = 0.35;
                    ctx.fillText(char, currentX + xOffset, baselineY + yOffset);

                    currentX += charWidth * 1.1;
                }

                ctx.textAlign = prevAlign;
            };

            const colors = [
                'rgba(230, 110, 110, 0.7)',
                'rgba(140, 171, 111, 0.7)',
                'rgba(230, 110, 110, 0.7)',
                'rgba(140, 171, 111, 0.7)',
                'rgba(124, 128, 194, 0.7)',
                'rgba(186, 85, 211, 0.7)',
                'rgba(255, 165, 0, 0.7)',
                'rgba(75, 0, 130, 0.7)',
                'rgba(64, 224, 208, 0.7)',
                'rgba(255, 20, 147, 0.7)',
                'rgba(255, 215, 0, 0.7)',
                'rgba(0, 128, 128, 0.7)',
                'rgba(219, 112, 147, 0.7)',
                'rgba(106, 90, 205, 0.7)',
                'rgba(255, 99, 71, 0.7)',
                'rgba(147, 112, 219, 0.7)',
                'rgba(60, 179, 113, 0.7)',
                'rgba(238, 130, 238, 0.7)',
                'rgba(218, 165, 32, 0.7)',
                'rgba(72, 209, 204, 0.7)',
                'rgba(199, 21, 133, 0.7)',
                'rgba(255, 140, 0, 0.7)'
            ];

            for (let y = startY; y < endY; y += verticalSpacing) {
                let offsetX = (Math.floor(y / verticalSpacing) % 2) * (horizontalSpacing / 2);

                for (let x = startX + offsetX; x < endX; x += horizontalSpacing) {
                    const amplitude = fontSize * 0.8;
                    const frequency = 0.04;
                    ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                    drawWavyText(watermarkText, x, y, amplitude, frequency);
                }
            }

            ctx.restore();
            ctx.globalAlpha = 1;
        }
    </script>
</body>

</html>